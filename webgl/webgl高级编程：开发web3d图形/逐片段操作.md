在片段着色器之后，都要把每个片段传送到流水线的下一个阶段：逐片段操作。

顾名思义，来自片段着色器的每一个片段，都可以以不同方式影响绘制缓存中的一个像素，具体取决于逐片段操作的条件和结果。

![[Pasted image 20220120092740.png]]

### 1、裁剪测试
决定片段是否位于裁剪矩形中。

此裁剪矩形是由一个左下角的坐标、一个宽度和高度决定的。

如果片段位于裁剪矩形内，则通过测试，并把片段传递给下一个阶段。否则丢弃。

### 2、多重采样片段操作

这一步操作修改片段的 alpha 值和覆盖值（coverage），作为抗锯齿的一个措施。

> 抗锯齿技术：用来改善多边形线框外观，使它看起来没有锯齿，更加光滑。

### 3、深度缓存测试
[[帧缓存#Z-缓存（Z-buffer）]]

> 对于每个像素，深度缓存都保存观察者到当前最近图元的距离。

对于传入的片段，把它的 z 值与深度缓存中同一位置的z值进行比较。

如果传入的片段更小，表示比原来的像素位置距离观察者更近。则传入的片段通过测试。

反之更远，则表示新片段被绘制缓存中的像素遮挡，因此丢弃这个片段。

### 4、融合
利用融合，把传入片段的颜色与已经在[[帧缓存#颜色缓存（color buffer）]]中相应位置的片段的颜色进行组合。

> 当我们要创建透明对象时，就需要使用融合技术。

### 5、抖动（dithering）
绘制缓存之前的最后一个步骤是抖动（dithering）。

[[帧缓存#颜色缓存（color buffer）]]用有限的二进制位数表示每个颜色。

抖动以某种方式排列颜色，得到比实际颜色更多的颜色。当颜色缓存的可用颜色数有限时，抖动就非常有用。